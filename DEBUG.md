# デバッグガイド

VSCodeでブラウザの動作を確認しながらデバッグする方法

## 準備

1. VSCodeでこのフォルダを開く
2. Bunがインストールされていることを確認
   ```bash
   bun --version
   ```

## デバッグ方法

### 方法1: スクレイピングのデバッグ（推奨）

ブラウザの動作を目で見ながらステップ実行できます。

1. **VSCodeでファイルを開く**
   - [test-scraper.ts](test-scraper.ts) を開く

2. **ブレークポイントを設定**
   - 左側の行番号をクリックして、止めたい場所にブレークポイントを設定
   - 例: 56行目（ページアクセス）、68行目（物件名入力）など

3. **デバッグ開始**
   - `F5` キーを押す
   - または、左サイドバーの「実行とデバッグ」→「Debug Scraper Test (ヘッドレスOFF)」を選択して再生ボタン

4. **ブラウザが開きます**
   - 実際のブラウザウィンドウが開き、操作が見えます
   - 各操作は500msのスローモーションで実行されます
   - DevToolsも自動で開きます

5. **ステップ実行**
   - `F10`: 次の行へ（ステップオーバー）
   - `F11`: 関数の中に入る（ステップイン）
   - `Shift+F11`: 関数から出る（ステップアウト）
   - `F5`: 次のブレークポイントまで実行

6. **変数の確認**
   - 左サイドバーの「変数」パネルで値を確認
   - マウスオーバーでも値が見れます

### 方法2: サーバー全体のデバッグ

1. **VSCodeでファイルを開く**
   - [index.ts](index.ts) または [src/scraper.ts](src/scraper.ts) を開く

2. **ブレークポイントを設定**

3. **デバッグ開始**
   - `F5` キーを押す
   - または「Debug Server」を選択

4. **ブラウザでUIを操作**
   - `http://localhost:3000` を開く
   - 「手動チェック」ボタンをクリック
   - → ブレークポイントで停止します

## 便利な設定

### ヘッドレスモードの切り替え

**[src/scraper.ts](src/scraper.ts)** の30行目:

```typescript
// ヘッドレスOFF（ブラウザが見える）
headless: false,

// ヘッドレスON（バックグラウンド実行）
headless: true,
```

### スローモーションの調整

**[test-scraper.ts](test-scraper.ts)** の24行目:

```typescript
slowMo: 500,  // 500ms = ゆっくり
slowMo: 100,  // 100ms = 少し遅い
slowMo: 0,    // 遅延なし
```

### タイムアウトの調整

デバッグ中はタイムアウトを長めに:

```typescript
page.setDefaultTimeout(60000);  // 60秒
```

## トラブルシューティング

### デバッガーが接続できない

```bash
# Bunのパスを確認
which bun

# launch.jsonの runtimeExecutable を実際のパスに変更
```

### ブレークポイントで止まらない

- ソースマップが有効か確認
- `tsconfig.json` に `"sourceMap": true` があることを確認

### ブラウザが開かない

- Playwrightがインストールされているか確認
  ```bash
  bunx playwright install chromium
  ```

## デバッグのコツ

1. **段階的に確認**
   - まず `test-scraper.ts` で各ステップを確認
   - 問題がなければ本番コード `src/scraper.ts` をデバッグ

2. **セレクターの確認**
   - ブラウザのDevToolsで要素を確認
   - セレクターが正しいか検証

3. **タイミング問題**
   - `waitForTimeout()` を追加してタイミングを調整
   - `waitForSelector()` で要素の出現を待つ

4. **スクリーンショット**
   - 各ステップでスクリーンショットを撮影
   - 何が起きているか後から確認

## 次のステップ

デバッグが完了したら:

1. ヘッドレスモードをONに戻す
2. スローモーションを無効化
3. 本番環境でテスト